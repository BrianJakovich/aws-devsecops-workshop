{"AWSTemplateFormatVersion":"2010-09-09","Description":"Deployment of the AWS DevSecOps Workshop \\\n    Penetration Testing application.","Parameters":{"InstanceType":{"Type":"String","Description":"EC2 Instance Type to deploy.","Default":"t2.micro"},"VPCID":{"Type":"AWS::EC2::VPC::Id","Description":"Amazon VPC ID to deploy infrastructure into."},"SubnetId":{"Type":"AWS::EC2::Subnet::Id","Description":"Subnet ID to deploy infrastructure into."},"JenkinsConnectorSG":{"Type":"String","Description":"Jenkins Security group for ingress"}},"Resources":{"WaitHandle":{"Type":"AWS::CloudFormation::WaitConditionHandle"},"EC2Waiter":{"DependsOn":"ZapServer","Properties":{"Handle":{"Ref":"WaitHandle"},"Timeout":"300"},"Type":"AWS::CloudFormation::WaitCondition"},"ZapServer":{"Properties":{"ImageId":"ami-34287123","InstanceType":{"Ref":"InstanceType"},"NetworkInterfaces":[{"AssociatePublicIpAddress":true,"DeleteOnTermination":true,"SubnetId":{"Ref":"SubnetId"},"DeviceIndex":0,"GroupSet":[{"Ref":"JenkinsConnectorSG"}]}],"Tags":[{"Key":"Name","Value":"AWS DevSecOps Workshop - Zap Penetration Server"}],"UserData":{"Fn::Base64":{"Fn::Join":["",["#!/bin/bash\n","export wait_handle=\"",{"Ref":"WaitHandle"},"\"\n","#!/bin/bash\n","set -ex\n","\n","# Create the CloudFormation wait handle JSON\n","cat > /tmp/cfn-success <<CFNSUCCESS\n","{\n","   \"Status\" : \"SUCCESS\",\n","   \"Reason\" : \"Configuration Complete\",\n","   \"UniqueId\" : \"$(uuidgen)\",\n","   \"Data\" : \"Application has completed configuration.\"\n","}\n","CFNSUCCESS\n","\n","# Emit success to CloudFormation\n","curl -T /tmp/cfn-success \"${wait_handle}\"\n"]]}}},"Type":"AWS::EC2::Instance"}},"Outputs":{"EC2PublicIP":{"Value":{"Fn::GetAtt":["ZapServer","PublicIp"]}},"EC2PrivateIP":{"Value":{"Fn::GetAtt":["ZapServer","PrivateIp"]}}}}